# Решение задачки на проектирование
### Как это можно использовать.
В каталоге [app](https://github.com/alex-kl-sandr/KROK/tree/master/app) расположена вся структура файлов данной реализации.

Так как у нас предполагается неопределенное количество компонентов теста(вопросы/ответы), приложение должно уметь создавать новые компоненты.
Для простоты понимания их можно расценивать как мини тесты одного глобального теста как некой сущности(таблицы).

Для создания нового объекта Test мы должны получить входные параметры от пользователя из формы создания/редактирования(допустим что она у нас есть).
Эти данные могут иметь следующую структуру:
```php
$newTestData = [
    'id'       => 1, // в случае редактирования
    'question' => 'New question?',
    'answers'  => [
        1 => 'New answer1',
        0 => 'New answer2',
        2 => 'New answer3'
    ]
];
```
Индексы у answers - это условные идентификаторы для групп принадлежности(Повар, Гурман), которые пользователь может при создании нового теста(точнее компонента теста) указывать, чтобы каждый ответ соответствовал какой то определенной группе.
Это нужно для подсчета баллов и выявления результатов пренадлежности респондентов.

Для простоты опустим детали проверки и другие подготовительные работы, которые разумеется следует провести прежде чем продолжать работать с этими данными.

Далее мы можем использовать фабрику чтобы создать наш новый объект Test передав в него полученые от пользоватля данные:
```php
$newTest = new \App\TestFactory($newTestData);
```
После этого мы можем работать с этим объектом и после передать его на сохранение в базу либо предусмотреть собственную реализацию этого действия(детали работы с базой тут не рассматриваются).
Для простоты будем исходить из того, что у нас есть общая таблица "test" в которой каждое поле - это идентификатор вопроса, сам вопрос и ответы(к примеру в json формате).

После создания всех необходимых тестов(вопросов/ответов) мы можем получить их из базы в виде коллекции(массива) и передать их для отображения пользователю для прохождения теста.

Далее мы получаем от пользователя из формы прохождения теста данные результата в виде массива вопрос - ответ, к примеру так:
```php
$testResultData = [
    question_1 => 1,
    question_2 => 0,
    question_3 => 1,
    ...
]
```
Где значения ответов - это идентификаторы групп принадлежности по соответствующему вопросу о которых ранее упомяналось.

Для подсчета результатов теста используются две стратегии CookStrategy и FoodieStrategy, каждая из которых имеет свою реализацию.
К примеру так можно получить результаты для наших групп:

```php
// Подготовим наши данные для расчетов
$testResultData = array_filter($_REQUEST, function ($key) {
    return strpos($key,'question_') !== false;
}, ARRAY_FILTER_USE_KEY);

// Создадим Тестера, который управляет стратегиями для получения нужного результата
$tester = new \App\Tester();

// Получим соответствующие результаты по каждой группе в процентах принажлежности респондента к той или иной группе
$cookTestResult = $tester->setStrategy(new \App\CookStrategy())->getTestResult($testResultData);
if ($cookTestResult != 100) {
    $foodieTestResult = $tester->setStrategy(new \App\FoodieStrategy())->getTestResult($testResultData);
}
 ```
 После всех необходимых подготовительных работ с данными результатов теста, передадим их пользователю в качестве общего результата пройденного теста.
